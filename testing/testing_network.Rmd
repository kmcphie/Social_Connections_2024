---
title: "Testing Network"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(igraph)
library(readr)
library(tidyverse)
library(shiny)
library(shinythemes)
library(readxl)
library(visNetwork)
```

```{r}
# visNetwork testing 

nodes_responses <- responses_clean %>%
    select(id) 

nodes <- data.frame(id = 1:309)

edges_responses <- responses_clean %>%
  mutate(from = id) %>%
  mutate(to = sports) %>%
  select(id, from, to)

visNetwork(nodes_responses, edges_responses)
```

```{r}
# We can use the graph_from_data_frame function, which takes two arguments: d, 
# the data frame with the edge list in the first two columns; and vertices, a 
# data frame with node data with the node label in the first column. (Note that 
# igraph calls the nodes vertices, but itâ€™s exactly the same thing.)

test_nodes <- data.frame(id = 1:3)
test_edges <- data.frame(from = c(1,2), to = c(1,3))

test_network <- graph_from_data_frame(d=test_edges, vertices=test_nodes, directed=F)

plot(test_network)

test_response_network <- graph_from_data_frame(d=edges_responses, vertices=nodes_responses, directed=F)

```

```{r}
# Jeremiah's Code ---------------------------------------------------------


output$mark_plot <- renderVisNetwork({
  nodes2 <- read_csv("data/nodes2.csv")
  edges2 <- read_csv("data/edges2.csv")
  
  # Changed shape, color, and size for each group
  
  visNetwork(nodes2, edges2) %>%
    visGroups(groupname = "Dorms", color = "darkblue", shape = "square", size = 65) %>%
    visGroups(groupname = "Pre-Orientation", color = "darkred", shape = "square", size = 45) %>%
    visGroups(groupname = "Sports", color = "darkgreen", shape = "square", size = 45) %>%
    
    # Added functionality to highlight close connections when hovering over node
    
    visOptions(nodesIdSelection = list(enabled = TRUE,
                                       style = "margin-bottom: -30px; visibility: hidden"),
               highlightNearest = list(enabled = T, degree = 2, hover = T),
               selectedBy = "group") %>%
    
    # Adjusted physics to decrease load time
    
    visPhysics(
      solver = "forceAtlas2Based", 
      timestep = 0.5,
      minVelocity = 1,
      maxVelocity = 30,
      forceAtlas2Based = list(gravitationalConstant = -200, damping = 1),
      stabilization = list(iterations = 300, updateInterval = 10),
      adaptiveTimestep = TRUE) %>%
    
    # Added legend for groups
    
    visLegend(zoom = FALSE) %>%
    
    # Disabled graph movement within window
    
    visInteraction(dragView = FALSE, 
                   zoomView = FALSE,
                   navigationButtons = TRUE)
```