---
title: "Testing Graphs"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(ggplot2)
library(tidyverse)
library(ggthemes)
```

```{r}
# Satisfaction Graph 

View(responses_clean)
overall_satisfaction <- responses_clean %>%
  mutate(satisfaction = as_factor(satisfaction)) %>%
  filter(satisfaction != "NA") %>%
  group_by(satisfaction) %>%
  summarize(count = n())

View(overall_satisfaction)

overall_satisfaction %>%
  ggplot(aes(x = fct_relevel(satisfaction, 
                               levels = c("Very_Dissatisfied",
                                          "Dissatisfied",
                                          "Neutral",
                                          "Satisfied",
                                          "Very_Satisfied")), 
                 y = count)) +
      geom_col(fill = "#6fb4d2") +
      theme_bw() +
      theme(legend.position = "none") +
      labs(
        title = "Overall Satisfaction with Social Connections Among Harvard First-Years",
        x = "Self-Reported Level of Satisfaction with Social Connections",
        y = "Count"
      ) +
      theme(title = element_text(size = 14, face = "bold"),
            axis.title.x = element_text(size = 12, face = "plain"),
            axis.title.y = element_text(size = 12, face= "plain")) 

sat_by_loc <- responses_clean %>%
  mutate(satisfaction = as_factor(satisfaction)) %>%
  filter(satisfaction != "NA") %>%
  mutate(satisfaction = str_replace(satisfaction, pattern = "Very Satisfied", replacement = "2"),
             satisfaction = str_replace(satisfaction, pattern = "Satisfied", replacement = "1"),
             satisfaction = str_replace(satisfaction, pattern = "Neutral", replacement = "0"),
             satisfaction = str_replace(satisfaction, pattern = "Dissatisfied", replacement = "-1"),
             satisfaction = str_replace(satisfaction, pattern = "Very Dissatisfied", replacement = "-2"))
  group_by(satisfaction, location) %>%
  summarize(count = n())

View(sat_by_loc)

sat_by_loc %>%
  ggplot(aes(x = fct_relevel(satisfaction, 
                               levels = c("Very_Dissatisfied",
                                          "Dissatisfied",
                                          "Neutral",
                                          "Satisfied",
                                          "Very_Satisfied")), 
                 y = count)) +
      geom_col(fill = "#6fb4d2") +
      facet_wrap(~ location) +
      theme_bw() +
      theme(legend.position = "none") +
      labs(
        title = "Overall Satisfaction with Social Connections \n Among Harvard First-Years",
        x = "Self-Reported Level of Satisfaction with Social Connections",
        y = "Count"
      ) +
      theme(title = element_text(size = 14, face = "bold"),
            axis.title.x = element_text(size = 12, face = "plain"),
            axis.title.y = element_text(size = 12, face= "plain")) 
  
```

```{r}
# Satisfaction by Location 

overall_satisfaction_by_location <- responses_clean %>%
  mutate(satisfaction = as_factor(satisfaction)) %>%
  select(satisfaction, location) %>%
  filter( location %in% c("The Yard", 
                          "A River House", 
                          "At Home (in the US)",
                          "At Home (international student)")) %>%
  group_by(satisfaction, location) %>%
  summarize(count = n(), .groups = "drop") %>%
  ggplot(aes(x = satisfaction, y = count)) +
  geom_col() +
  facet_wrap(~location) +
  geom_col(fill = "#6fb4d2") +
  theme_bw() +
  labs(title = "Overall Satisfaction with Social Connections \n Among Harvard First-Years by Location",
       x = "Self-Reported Level of Satisfaction with Social Connections",
       y = "Count") +
      theme(title = element_text(size = 14, face = "bold"),
            axis.title.x = element_text(size = 12, face = "plain"),
            axis.title.y = element_text(size = 12, face= "plain"))

overall_satisfaction_by_location
```

```{r}
# Predicted Satisfaction Based on Meeting 

set.seed(10)
closeness_model <- stan_glm(p1_closeness ~ p1_meet - 1,
                            data = responses_clean,
                            refresh = 0)

mean_value <- closeness_model %>% 
  as_tibble() %>% 
  pivot_longer(cols = 1:26,
               names_to = "meet",
               values_to = "value") %>%
  filter(meet %in% c("p1_meetZoom lecture", 
                     "p1_meetSocial media (GroupMe, Instagram, Discord, etc.)",
                     "p1_meetIn-person (The courtyard, the line at the dining hall, etc.)")) %>%
  # pull(value) %>%
  group_by(meet) %>%
  summarize(mean = mean(value))

closeness_model %>%
  as_tibble() %>%
  pivot_longer(cols = 1:26,
               names_to = "meet",
               values_to = "value") %>%
  filter(meet %in% c("p1_meetZoom lecture", 
                     "p1_meetSocial media (GroupMe, Instagram, Discord, etc.)",
                     "p1_meetIn-person (The courtyard, the line at the dining hall, etc.)")) %>%
  ggplot(aes(x = value)) +
  geom_histogram(aes(y = after_stat(count/sum(count))), 
                   binwidth = 0.07,
                 fill = "#6fb4d2",
                 color = "white") +
  facet_wrap(~ meet) +
  labs(title = "Posterior Probability Distribution",
         subtitle = "Closeness Based on Meeting",
         x = "Closeness",
         y = "Probability") +
  # geom_vline(xintercept = mean_value,
  #            color = "red") +
  theme_bw()
  
```

