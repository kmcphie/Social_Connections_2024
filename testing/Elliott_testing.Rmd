---
title: "Elliott_testing"
author: "Elliott Detjen"
date: "10/31/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(rstanarm)

sat_con <- responses_clean %>%
  select(group_size, satisfaction, pre_o, sports, race, gap_year, location) %>%
  group_by(race) %>%
  ggplot(aes(x = satisfaction, y = group_size, alpha = 0.5)) +
  geom_point(na.rm = FALSE) +
  geom_jitter() 

sat_con


class(responses_clean$group_size)


nice <- stan_glm(data = responses_clean,
                 formula = group_size ~ 1,
                 refresh = 0,
                 family = gaussian())

nice

graph <- nice %>%
  as_tibble() %>%
  rename(mu = `(Intercept)`) %>%
  ggplot(aes(x = mu)) +
  geom_histogram(aes(y = after_stat(count / sum(count))), binwidth = 0.1,
                 fill = "dodgerblue", alpha = 0.5)

graph

```

```{r location}
    
dorm <- responses_clean %>%
  summarize("Yard" = sum(location == "The Yard"),
            "Home (US)" = sum(location == "At Home (in the US)"),
            "Home (International)" = sum(location == "At Home (international student)"),
            "Quad" = sum(location == "The Quad"),
            "Union" = sum(location == "Union Dorm"),
            "River" = sum(location == "A River House")) %>%
  pivot_longer(everything(), names_to = "location", values_to = "count") %>%
  arrange(desc(.))

dorm_graph <- dorm %>%
  ggplot(aes(x = location, y = count / sum(count), fill = location)) +
  geom_col() +
  scale_y_continuous(labels = scales::percent) +
  geom_text(aes(label = count), size = 3, 
            position = position_nudge(y  = 0.015)) +
  coord_flip() +
  theme_bw() +
  labs(x = "Location", y = "Percentage of Respondents")
  
dorm_graph

```

```{r satisfaction, top 4 (using Jeremiah code for side by side comparison)}

library(ggthemes)

      freshmen_satisfaction <- responses_clean %>%
        nest(top4 = c(p1_name, p2_name,
                      p3_name, p4_name)) %>%
        select(id, satisfaction, top4, name)
      
      # List of all names listed in top 4 friends, with repeats
      
      freshmen_top4_list <- unlist(freshmen_satisfaction$top4)
      
      # Calculate overall satisfaction score mean
      
      all_freshmen_satisfaction_mean <- freshmen_satisfaction %>%
        summarize(mean = mean(satisfaction, na.rm = TRUE)) %>%
        pull(mean)
      
      # Create a tibble for comparing satisfaction levels vs. whether or not
      # they appear.
      
      compare_satisfaction <- freshmen_satisfaction %>%
        mutate(appear = name %in% freshmen_top4_list) %>%
        group_by(appear) %>%
        summarize(mean_satis = mean(satisfaction, na.rm = TRUE))
      
      compare_satisfaction %>%
        ggplot(aes(x = appear, y = mean_satis, fill = appear)) +
        geom_bar(stat = "identity") + 
        guides(fill=FALSE) +
        scale_x_discrete(labels = c("No", "Yes")) +
        labs(
          x = "Did the respondent's name appear in other respondents' top 4 friends lists?",
          y = "Mean Satisfaction Score",
          title = "Comparing mean satisfaction scores of respondents",
          subtitle = "Respondents who appeared in others lists were more satisfied",
          caption = "Very Dissatisfied = -2, Dissatisfied = -1, Neutral = 0, Satisfied = 1, Very Satisfied = 2"
        ) +
        geom_hline(yintercept = all_freshmen_satisfaction_mean) +
        theme_economist()
      
```

```{r cross checking top 4 for contact}

Top_4_Contacting <- read_csv("shiny_app/raw_data/Top_4_Contacting.csv", col_types = cols(
  respondent = col_character(),
  top_4 = col_character(),
  respondent_trim = col_character(),
  top_4_trim = col_character(),
  x = col_double(),
  y = col_double()
))



cross <- Top_4_Contacting %>%
  select(c(-x, -y, -respondent, -top_4)) %>%
  mutate(cross_check = !(cross$top_4_trim %in% cross$respondent_trim))

filtered <- cross %>%
  select(top_4_trim, cross_check) %>%
  filter(cross_check == TRUE)

top_4_trim_unique <- unique(filtered$top_4_trim) %>%
  as_tibble() %>%
  drop_na()

top_4_trim_unique 

# Names attached to TRUE values in the cross_check column are individuals mentioned in
# a respondent's top four friends, but these individuals have not filled out the survey.
# Compiled to reach out to for a survey request. 

```