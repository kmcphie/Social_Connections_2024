---
title: "Section Regression Work"
author: "Ava Swanson"
date: "11/3/2020"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(rstanarm)
```

```{r}
responses <- readRDS("shiny_app/responses.rds") 

responses$gap_yeardummy <- 0 

responses$gap_yeardummy[which(responses$gap_year == "Yes")] <- 1
```

```{r}
fit <- stan_glm(gap_yeardummy ~ p1_closeness + gender + race,
                data = responses,
                refresh = 0,
                family = binomial())

fit
```
```{r}
# This is model work from the textbook ch 10

library(tidymodels)
data(ames)
ames <- mutate(ames, Sale_Price = log10(Sale_Price))

set.seed(123)
ames_split <- initial_split(ames, prob = 0.80)
ames_train <- training(ames_split)
ames_test  <-  testing(ames_split)

ames_rec <- 
  recipe(Sale_Price ~ Neighborhood + Gr_Liv_Area + Year_Built + Bldg_Type + 
           Latitude + Longitude, data = ames_train) %>%
  step_log(Gr_Liv_Area, base = 10) %>% 
  step_other(Neighborhood, threshold = 0.01) %>% 
  step_dummy(all_nominal()) %>% 
  step_interact( ~ Gr_Liv_Area:starts_with("Bldg_Type_"))

lm_model <- linear_reg() %>% 
  set_engine("lm")

lm_wflow <- 
  workflow() %>% 
  add_model(lm_model) %>% 
  add_recipe(ames_rec)

lm_fit <- fit(lm_wflow, ames_train)

rf_model <- 
  rand_forest(trees = 1000) %>% 
  set_engine("ranger") %>% 
  set_mode("regression")

rf_wflow <- 
  workflow() %>% 
  add_recipe(recipe(Sale_Price ~ Neighborhood + Gr_Liv_Area + 
                                 Year_Built + Bldg_Type,
                    data = ames_train)) %>% 
  add_model(rf_model) 


set.seed(55)
ames_folds <- vfold_cv(ames_train, v = 10)


set.seed(130)
rf_res <- rf_wflow %>% 
  fit_resamples(resamples = ames_folds, 
                control = control_resamples(save_pred = TRUE))
```


```{r}
library(tidymodels)
data(ames)
ames <- mutate(ames, Sale_Price = log10(Sale_Price))

set.seed(123)
responses_split <- initial_split(ames, prob = 0.80)
ames_train <- training(ames_split)
ames_test  <-  testing(ames_split)

ames_rec <- 
  recipe(Sale_Price ~ Neighborhood + Gr_Liv_Area + Year_Built + Bldg_Type + 
           Latitude + Longitude, data = ames_train) %>%
  step_log(Gr_Liv_Area, base = 10) %>% 
  step_other(Neighborhood, threshold = 0.01) %>% 
  step_dummy(all_nominal()) %>% 
  step_interact( ~ Gr_Liv_Area:starts_with("Bldg_Type_"))

lm_model <- linear_reg() %>% 
  set_engine("lm")

lm_wflow <- 
  workflow() %>% 
  add_model(lm_model) %>% 
  add_recipe(ames_rec)

lm_fit <- fit(lm_wflow, ames_train)

rf_model <- 
  rand_forest(trees = 1000) %>% 
  set_engine("ranger") %>% 
  set_mode("regression")

rf_wflow <- 
  workflow() %>% 
  add_recipe(recipe(Sale_Price ~ Neighborhood + Gr_Liv_Area + 
                                 Year_Built + Bldg_Type,
                    data = ames_train)) %>% 
  add_model(rf_model) 


set.seed(55)
ames_folds <- vfold_cv(ames_train, v = 10)


set.seed(130)
rf_res <- rf_wflow %>% 
  fit_resamples(resamples = ames_folds, 
                control = control_resamples(save_pred = TRUE))
```









